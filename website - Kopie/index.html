<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
